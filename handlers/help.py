from aiogram import Router, F
from aiogram.types import Message
from aiogram.filters import Command
from aiogram.fsm.context import FSMContext
from keyboards import main_menu_keyboard
from config import ADMIN_ID, MAX_USER_WORDS
from aiogram import Bot # –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–ª—è —è–≤–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ bot
from utils.audio_cleanup import cleanup_guess_audio
import html # –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç html –¥–ª—è —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

router = Router()

@router.message(F.text == "‚ùì –°–ø—Ä–∞–≤–∫–∞")
async def show_help(message: Message, state: FSMContext, bot: Bot):
    # –£–¥–∞–ª—è–µ–º –∞—É–¥–∏–æ—Ñ–∞–π–ª—ã –∏–∑ –∏–≥—Ä—ã "–£–≥–∞–¥–∞–π —Å–ª–æ–≤–æ" –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –∫ —Å–ø—Ä–∞–≤–∫–µ
    await cleanup_guess_audio(message, state, bot)
    
    help_text = (
        "–≠—Ç–æ –±–æ—Ç –¥–ª—è –ø–æ–º–æ—â–∏ —à–∫–æ–ª—å–Ω–∏–∫–∞–º –≤ –∏–∑—É—á–µ–Ω–∏–∏ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞.\n\n" +
        "<b>–û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã:</b>\n" +
        "üìñ –£—á–∏—Ç—å —Å–ª–æ–≤–∞: –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–π—Ç–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –∞–Ω–≥–ª–∏–π—Å–∫–∏–º–∏ —Å–ª–æ–≤–∞–º–∏ –∏ –∏—Ö —Ä—É—Å—Å–∫–∏–º –ø–µ—Ä–µ–≤–æ–¥–æ–º.\n" +
        "üéÆ –ò–≥—Ä—ã: –ò–≥—Ä–∞–π—Ç–µ –≤ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã –¥–ª—è –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏—è –∑–Ω–∞–Ω–∏–π.\n" +
        "üìù –¢–µ—Å—Ç –∑–Ω–∞–Ω–∏–π: –ü—Ä–æ–π–¥–∏—Ç–µ –Ω–µ–±–æ–ª—å—à–æ–π —Ç–µ—Å—Ç –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤.\n" +
        "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å–≤–æ–∏ —É—Å–ø–µ—Ö–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É.\n" +
        "‚ÑπÔ∏è –°–ø—Ä–∞–≤–∫–∞: –ö—Ä–∞—Ç–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ –∏ –µ–≥–æ —Ñ—É–Ω–∫—Ü–∏—è—Ö.\n\n" +
        "–î–ª—è –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é, –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É '‚¨ÜÔ∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é'.\n" +
        "/start - –µ—Å–ª–∏ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–Ω–æ–ø–∫–∏ (–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞)\n\n" +
        "<b>üìö –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ª–æ–≤–∞–º–∏ (–¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π):</b>\n" +
        f"/my_set - —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–≤–æ–∏–º –ª–∏—á–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º —Å–ª–æ–≤ (—Å–æ–∑–¥–∞—Ç—å, –¥–æ–±–∞–≤–∏—Ç—å, —É–¥–∞–ª–∏—Ç—å, –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å). <b>–ú–∞–∫—Å–∏–º—É–º {MAX_USER_WORDS} —Å–ª–æ–≤.</b>\n" +
        f"  ‚Ä¢ –î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è: /add_my_word <code>{html.escape('–∞–Ω–≥–ª–∏–π—Å–∫–æ–µ_—Å–ª–æ–≤–æ=—Ä—É—Å—Å–∫–∏–π_–ø–µ—Ä–µ–≤–æ–¥')}</code>\n" +
        f"  ‚Ä¢ –î–ª—è —É–¥–∞–ª–µ–Ω–∏—è: /del_my_word <code>{html.escape('–∞–Ω–≥–ª–∏–π—Å–∫–æ–µ_—Å–ª–æ–≤–æ')}</code>\n" +
        f"  ‚Ä¢ –î–ª—è –≤—ã–±–æ—Ä–∞ –Ω–∞–±–æ—Ä–∞: /switch_my_set - –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–π –Ω–∞–±–æ—Ä —Å–ª–æ–≤ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è\n\n" +
        "<b>üìã –û–±—â–∏–µ –∫–æ–º–∞–Ω–¥—ã (–¥–ª—è –≤—Å–µ—Ö):</b>\n" +
        f"/list <code>{html.escape('[–∏–º—è_—Ñ–∞–π–ª–∞.json]')}</code> - —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤ –∏–∑ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∞—à —Ç–µ–∫—É—â–∏–π –∞–∫—Ç–∏–≤–Ω—ã–π –Ω–∞–±–æ—Ä)\n"
    )
    
    # –î–æ–±–∞–≤–ª—è–µ–º –∞–¥–º–∏–Ω—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - –∞–¥–º–∏–Ω
    if message.from_user.id == ADMIN_ID:
        admin_commands = (
            "\n\n<b>üîß –ê–¥–º–∏–Ω—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã:</b>\n" +
            "<b>üìÅ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞–º–∏ —Å–ª–æ–≤:</b>\n" +
            f"/files - –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ–∞–π–ª—ã —Å–æ —Å–ª–æ–≤–∞–º–∏\n" +
            f"/switch <code>{html.escape('–∏–º—è —Ñ–∞–π–ª–∞')}</code> - –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –≤–∞—à –∞–∫—Ç–∏–≤–Ω—ã–π —Ñ–∞–π–ª\n" +
            f"/current_file - –ø–æ–∫–∞–∑–∞—Ç—å –≤–∞—à —Ç–µ–∫—É—â–∏–π –∞–∫—Ç–∏–≤–Ω—ã–π —Ñ–∞–π–ª\n" +
            f"/create_file <code>{html.escape('–∏–º—è —Ñ–∞–π–ª–∞')}</code> - —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ñ–∞–π–ª\n" +
            f"/delete_file <code>{html.escape('–∏–º—è —Ñ–∞–π–ª–∞')}</code> - —É–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª\n\n" +
            "<b>üìù –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ª–æ–≤–∞–º–∏:</b>\n" +
            f"/add <code>{html.escape('[–∏–º—è —Ñ–∞–π–ª–∞.json]')}</code> —Å–ª–æ–≤–æ=–ø–µ—Ä–µ–≤–æ–¥ - –¥–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–≤–æ –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–π —Ñ–∞–π–ª (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∞—à —Ç–µ–∫—É—â–∏–π)\n" +
            f"/del <code>{html.escape('[–∏–º—è —Ñ–∞–π–ª–∞.json]')}</code> —Å–ª–æ–≤–æ - —É–¥–∞–ª–∏—Ç—å —Å–ª–æ–≤–æ –∏–∑ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∞—à —Ç–µ–∫—É—â–∏–π)\n" +
            f"/deduplicate_words <code>{html.escape('[–∏–º—è —Ñ–∞–π–ª–∞.json]')}</code> - —É–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã —Å–ª–æ–≤ –∏–∑ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é words.json)\n" +
            f"/admin_list <code>{html.escape('[–∏–º—è —Ñ–∞–π–ª–∞.json]')}</code> - —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤ –∏–∑ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∞—à —Ç–µ–∫—É—â–∏–π)\n\n" +
            "<b>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏:</b>\n" +
            f"/users - –ø–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —é–∑–µ—Ä–æ–≤\n" +
            f"/stats - –ø–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤—Å–µ—Ö —é–∑–µ—Ä–æ–≤\n" +
            f"/deluser <code>ID</code> - —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n\n" +
            "<b>‚öôÔ∏è –£—Ç–∏–ª–∏—Ç—ã:</b>\n" +
            f"/convert_audio - –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∞—É–¥–∏–æ—Ñ–∞–π–ª—ã OGG –≤ MP3\n" +
            f"/new_sound - –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∞—É–¥–∏–æ—Ñ–∞–π–ª\n\n" +
            "<b>üí° –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:</b> –í—Å–µ –∫–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å —Ç–µ–∫—É—â–∏–º –∞–∫—Ç–∏–≤–Ω—ã–º —Ñ–∞–π–ª–æ–º —Å–ª–æ–≤."
        )
        help_text += admin_commands
    
    await message.answer(help_text, reply_markup=main_menu_keyboard, parse_mode="HTML")

@router.message(Command("help"))
async def show_help_command(message: Message, state: FSMContext, bot: Bot):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /help"""
    await show_help(message, state, bot)
